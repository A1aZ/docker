From c22bdec6a4d20cc400fc02c3e916296225694b7e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Sat, 2 Jun 2018 09:40:44 +0200
Subject: [PATCH 1/1] Fix running tests without billing app
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 weblate/settings_test.py        |  2 +-
 weblate/trans/tests/test_acl.py | 13 ++++++++++---
 2 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/weblate/settings_test.py b/weblate/settings_test.py
index 93ef87c55..446e834d1 100644
--- a/weblate/settings_test.py
+++ b/weblate/settings_test.py
@@ -113,7 +113,7 @@ SESSION_COOKIE_HTTPONLY = False
 
 # Test optional apps as well
 INSTALLED_APPS += (
-    'weblate.billing',
+#    'weblate.billing',
     'weblate.gitexport',
     'weblate.legal',
 )
diff --git a/weblate/trans/tests/test_acl.py b/weblate/trans/tests/test_acl.py
index ffcb9f1af..0f04efbf7 100644
--- a/weblate/trans/tests/test_acl.py
+++ b/weblate/trans/tests/test_acl.py
@@ -259,6 +259,10 @@ class ACLTest(FixtureTestCase):
     def test_acl_groups(self):
         """Test handling of ACL groups.
         """
+        if 'weblate.billing' in settings.INSTALLED_APPS:
+            billing_group = 1
+        else:
+            billing_group = 0
         match = '{}@'.format(self.project.name)
         self.project.access_control = Project.ACCESS_PUBLIC
         self.project.enable_review = False
@@ -270,13 +274,15 @@ class ACLTest(FixtureTestCase):
         self.project.enable_review = True
         self.project.save()
         self.assertEqual(
-            9, Group.objects.filter(name__startswith=match).count()
+            8 + billing_group,
+            Group.objects.filter(name__startswith=match).count()
         )
         self.project.access_control = Project.ACCESS_PRIVATE
         self.project.enable_review = True
         self.project.save()
         self.assertEqual(
-            9, Group.objects.filter(name__startswith=match).count()
+            8 + billing_group,
+            Group.objects.filter(name__startswith=match).count()
         )
         self.project.access_control = Project.ACCESS_CUSTOM
         self.project.save()
@@ -291,7 +297,8 @@ class ACLTest(FixtureTestCase):
         self.project.access_control = Project.ACCESS_PRIVATE
         self.project.save()
         self.assertEqual(
-            9, Group.objects.filter(name__startswith=match).count()
+            8 + billing_group,
+            Group.objects.filter(name__startswith=match).count()
         )
         self.project.delete()
         self.assertEqual(
-- 
2.17.1

