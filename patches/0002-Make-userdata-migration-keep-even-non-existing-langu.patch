From 2a6dbd659b7834fc108fd8b548c54fe82da6fc45 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Fri, 29 Jun 2018 15:12:07 +0200
Subject: [PATCH 1/1] Make userdata migration keep even non existing languages
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 weblate/accounts/management/commands/importuserdata.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/weblate/accounts/management/commands/importuserdata.py b/weblate/accounts/management/commands/importuserdata.py
index d5ca554b2..bf6c04172 100644
--- a/weblate/accounts/management/commands/importuserdata.py
+++ b/weblate/accounts/management/commands/importuserdata.py
@@ -61,11 +61,11 @@ class Command(BaseCommand):
         profile.language = userprofile['language']
         for lang in userprofile['secondary_languages']:
             profile.secondary_languages.add(
-                Language.objects.get(code=lang)
+                Language.objects.auto_get_or_create(lang)
             )
         for lang in userprofile['languages']:
             profile.languages.add(
-                Language.objects.get(code=lang)
+                Language.objects.auto_get_or_create(lang)
             )
 
     def handle(self, **options):
-- 
2.17.1

